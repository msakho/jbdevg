<?xml version="1.0" encoding="UTF-8"?>
<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
    xmlns:cm="http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.1.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xmlns:jaxrs="http://cxf.apache.org/blueprint/jaxrs"
    xmlns:cxf-core="http://cxf.apache.org/blueprint/core"
    xmlns:cxf="http://camel.apache.org/schema/blueprint/cxf"
    
    xsi:schemaLocation="http://www.osgi.org/xmlns/blueprint/v1.0.0 https://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd
   http://cxf.apache.org/blueprint/jaxrs http://cxf.apache.org/schema/blueprint/jaxrs.xsd
    http://cxf.apache.org/blueprint/core http://cxf.apache.org/schema/blueprint/core.xsd
    http://camel.apache.org/schema/blueprint http://camel.apache.org/schema/blueprint/camel-blueprint.xsd"
    >
   
   
    <!-- OSGI blueprint property placeholder -->
    <cm:property-placeholder id="beosbank.placeholder"
        persistent-id="com.beosbank.esb.wsproxy.env.cfg" update-strategy="reload">
        <cm:default-properties>
            <cm:property name="vdb.url"     value="http://localhost:8080/odata"/>
            <cm:property name="vdb.user"    value="teiidUser"/>
            <cm:property name="vdb.password" value=""/>
            <cm:property name="proxy.httpBaseUrl" value=""/>
            
        </cm:default-properties>
    </cm:property-placeholder>
    
    
    <camelContext id="beosbank-vdb-wsproxy"
        xmlns="http://camel.apache.org/schema/blueprint" xmlns:order="http://fabric8.com/examples/order/v7">
       
        <route customId="true" id="vdb-proxy-route">
            <from uri="jetty://{{proxy.httpBaseUrl}}/{{proxy.uri}}?matchOnUriPrefix=true"/>
            <log  message="Request received ${headers} body=${body}"/>
       		<to uri="cxfrs:bean:vdbRestBackEndServer"/>
        </route>
    </camelContext>
    
    <!-- HTTP Endpoints-->
  	<cxf:rsClient id="vdbRestBackEndServer" address="${vdb.url}" loggingFeatureEnabled="true"/>
  	
  	
  	<!-- VDB Security Credentials -->
  	<conduit name="*.http-conduit"
   xmlns:sec="http://cxf.apache.org/configuration/security"
   xmlns="http://cxf.apache.org/transports/http/configuration">
   <authorization>
      <sec:UserName>${vdb.user}</sec:UserName>
      <sec:Password>${vdb.password}</sec:Password>
      <sec:AuthorizationType>Basic</sec:AuthorizationType>
   </authorization>
 </conduit>
  
</blueprint>
